{"version":3,"file":"index.js","sourceRoot":"","sources":["../src/index.ts"],"names":[],"mappings":"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","sourcesContent":["import { gotScraping } from 'got-scraping';\nimport * as cheerio from 'cheerio';\nimport { parse } from 'date-fns';\n\ntype Event = {\n\tdate: Date;\n\ttime: string;\n\tcurrency: string;\n\timpact: string;\n\tevent: string;\n\tactual: string | null;\n\tforecast: string | null;\n\tprevious: string | null;\n}\n\nexport type { Event };\n\nexport class Scraper {\n\tpublic async scrapeCalendar(options: { url?: string, proxyUrl?: string } = {}) {\n\t\tconst response = await gotScraping({\n\t\t\turl: options?.url || \"https://www.forexfactory.com/calendar\",\n\t\t\tproxyUrl: options?.proxyUrl,\n\t\t\theaders: {\n\t\t\t\t'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/58.0.3029.110 Safari/537.3',\n\t\t\t\t'Accept': 'text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8',\n\t\t\t\t'Accept-Language': 'en-US,en;q=0.5',\n\t\t\t\t'Referer': 'https://www.forexfactory.com/'\n\t\t\t}\n\t\t});\n\n\t\tconst parsedEvents = this.parse(response.body);\n\n\t\treturn parsedEvents;\n\t}\n\n\tprivate parse(body: string) {\n\t\tconst $ = cheerio.load(body);\n\t\tconst events = $('.calendar__row');\n\t\tlet lastParsedDate = '';\n\t\tlet lastParsedTime = '';\n\n\t\tconst parsedEvents: Event[] = [];\n\n\t\tevents.each((index, element) => {\n\t\t\tconst newDate = $(element).find('.calendar__date').text().trim();\n\t\t\tif (newDate && newDate.length > 0) {\n\t\t\t\tlastParsedDate = newDate;\n\t\t\t}\n\n\t\t\tconst time = $(element).find('.calendar__time').text().trim();\n\t\t\tconst currency = $(element).find('.calendar__currency').text().trim();\n\n\t\t\tconst impactClass = $(element).find('.calendar__impact').children()?.[0]?.attribs?.class;\n\t\t\tlet impact = \"Unknown\";\n\t\t\tif (impactClass?.includes('impact-yel')) {\n\t\t\t\timpact = \"Low\";\n\t\t\t} else if (impactClass?.includes('impact-red')) {\n\t\t\t\timpact = \"High\";\n\t\t\t} else if (impactClass?.includes('impact-ora')) {\n\t\t\t\timpact = \"Medium\";\n\t\t\t} else if (impactClass?.includes('impact-none')) {\n\t\t\t\timpact = \"None\";\n\t\t\t}\n\n\t\t\tconst event = $(element).find('.calendar__event').text().trim();\n\n\t\t\tconst actual = $(element).find('.calendar__actual').text().trim() || null;\n\t\t\tconst forecast = $(element).find('.calendar__forecast').text().trim() || null;\n\t\t\tconst previous = $(element).find('.calendar__previous').text().trim() || null;\n\n\t\t\tif (currency) {\n\t\t\t\tlet parsedDate = parse(lastParsedDate, 'EEE MMM d', new Date());\n\t\t\t\tlet parsedTime: string = \"\";\n\n\t\t\t\tif (time && time !== \"Tentative\" && time !== \"All Day\") {\n\t\t\t\t\tparsedTime = time;\n\t\t\t\t} else if (!time) {\n\t\t\t\t\tparsedTime = lastParsedTime;\n\t\t\t\t}\n\n\t\t\t\tif (parsedTime && parsedTime !== \"Tentative\" && parsedTime !== \"All Day\") {\n\t\t\t\t\tconst timeSplit = parsedTime.match(/(\\d{1,2}):(\\d{2})([ap]m)/);\n\n\t\t\t\t\tif (timeSplit) {\n\t\t\t\t\t\tconst hours = parseInt(timeSplit[1]) + (timeSplit[3] === 'pm' ? 12 : 0);\n\t\t\t\t\t\tconst minutes = parseInt(timeSplit[2]);\n\n\t\t\t\t\t\tparsedDate.setHours(hours, minutes);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tconst data: Event = {\n\t\t\t\t\tdate: parsedDate,\n\t\t\t\t\ttime: time || lastParsedTime,\n\t\t\t\t\tcurrency,\n\t\t\t\t\timpact,\n\t\t\t\t\tevent,\n\t\t\t\t\tactual,\n\t\t\t\t\tforecast,\n\t\t\t\t\tprevious\n\t\t\t\t};\n\t\t\t\tparsedEvents.push(data);\n\t\t\t}\n\n\t\t\tif (time) {\n\t\t\t\tlastParsedTime = time;\n\t\t\t}\n\t\t});\n\n\t\treturn parsedEvents;\n\t}\n}\n\n/* const t = new Scraper();\nt.scrapeCalendar().then(\n\t(data) => {\n\t\tconsole.log(data.map(({event, date, time}) => `${event} - ${date} - ${time}`));\n\t}\n); */"]}